var Map=React.createClass({displayName:"Map",componentDidMount:function(){var e=new BMap.Map("map");e.centerAndZoom(new BMap.Point(104.737059,36.394564),5),e.enableScrollWheelZoom(),e.addControl(new BMap.ScaleControl({anchor:BMAP_ANCHOR_TOP_LEFT})),e.addControl(new BMap.NavigationControl({enableGeolocation:!0})),e.addControl(new BMap.MapTypeControl({mapTypes:[BMAP_NORMAL_MAP,BMAP_HYBRID_MAP]}));var t=new BMap.Geolocation,a=this;t.getCurrentPosition(function(t){if(this.getStatus()==BMAP_STATUS_SUCCESS){var n=t.point,l=new BMap.Marker(n);e.addOverlay(l),e.panTo(n);var i=new BMap.Geocoder;i.getLocation(t.point,function(e){var t=e.addressComponents;document.getElementById("finder").value=t.province+", "+t.city+", "+t.district+", "+t.street+", "+t.streetNumber}),a.setLngLat(n.lng,n.lat)}else alert("自动定位失败："+this.getStatus())},{enableHighAccuracy:!0});var n=new BMap.Autocomplete({input:"finder",location:e});n.addEventListener("onhighlight",function(e){var t,a=e.fromitem.value,n="";e.fromitem.index>-1&&(n=a.province+a.city+a.district+a.street+a.business),t="FromItem<br />index = "+e.fromitem.index+"<br />value = "+n,n="",e.toitem.index>-1&&(a=e.toitem.value,n=a.province+a.city+a.district+a.street+a.business),t+="<br />ToItem<br />index = "+e.toitem.index+"<br />value = "+n,document.getElementById("searchResultPanel").innerHTML=t}),n.addEventListener("onconfirm",function(t){var n=t.item.value,l=n.province+n.city+n.district+n.street+n.business;document.getElementById("searchResultPanel").innerHTML="onconfirm<br />index = "+t.item.index+"<br />myValue = "+l;var i=new BMap.LocalSearch(e,{onSearchComplete:function(){var t=i.getResults().getPoi(0).point;e.centerAndZoom(t,15),e.addOverlay(new BMap.Marker(t)),a.setLngLat(t.lng,t.lat)}});i.search(l)});for(var l=new BMap.ContextMenu,i=[{text:"我在这里",callback:function(t){var a=new BMap.Point(t.lng,t.lat),n=new BMap.Geocoder;n.getLocation(a,function(t){var n=t.addressComponents;document.getElementById("finder").value=n.province+", "+n.city+", "+n.district+", "+n.street+", "+n.streetNumber;var l=new BMap.Marker(a);e.addOverlay(l)}),this.setLngLat(t.lng,t.lat)}.bind(this)}],r=0;r<i.length;r++)l.addItem(new BMap.MenuItem(i[r].text,i[r].callback,100));e.addContextMenu(l),$.ajax({url:"/friends",method:"GET",dataType:"json",success:function(t){"undefined"!=typeof t&&t.map(function(t){var a=new BMap.Point(t.lng,t.lat),n=new BMap.Marker(a);e.addOverlay(n);var l=new BMap.Label(t.username,{position:a,offset:new BMap.Size(10,-30)});l.setStyle({color:"red",fontSize:"12px",height:"20px",lineHeight:"18px",fontFamily:"微软雅黑"}),e.addOverlay(l)})}.bind(this)})},setLngLat:function(e,t){React.findDOMNode(this.refs.lng).value=e,React.findDOMNode(this.refs.lat).value=t},render:function(){return React.createElement("div",null,React.createElement("input",{type:"hidden",ref:"lng",name:"lng"}),React.createElement("input",{type:"hidden",ref:"lat",name:"lat"}),React.createElement("div",{id:"map",style:{width:"100%",height:"700px",border:"1px solid #DCDCDC"}}))}}),Notes=React.createClass({displayName:"Notes",render:function(){return React.createElement("ul",{className:"am-list am-list-static am-list-border am-list-striped"},React.createElement("li",null,"1. 请先输入自己的ID"),React.createElement("li",null,"2. 请允许浏览器获取你的位置"),React.createElement("li",null,"3. 如果自动定位有错误，请手动键入自己的位置",React.createElement("label",null,"（需要根据自动提示选取项目）"),"，或者在地图上使用右键标示自己的位置"),React.createElement("li",null,"4. 请勿冒用他人ID"),React.createElement("li",null,"5. 请注意保证自己的隐私"))}}),Register=React.createClass({displayName:"Register",componentDidMount:function(){React.findDOMNode(this.refs.id).focus(),React.findDOMNode(this.refs.submit).setAttribute("disabled","disabled")},getInitialState:function(){return{level_pending:!1}},handleGetLevel:function(){if(!this.state.level_pending){var e=React.findDOMNode(this.refs.level),t=React.findDOMNode(this.refs.id),a=React.findDOMNode(this.refs.submit);if(a.setAttribute("disabled","disabled"),""==t.value.trim())return t.focus(),void t.setAttribute("placeholder","ID不能为空");t.setAttribute("placeholder","ID"),e.setAttribute("disabled","disabled"),e.value="等级获取中...",this.setState({level_pending:!0}),$.ajax({url:"/level?id="+t.value.trim(),method:"GET",dataType:"json",success:function(t){if(-1==parseInt(t.level))e.value="获取失败";else{var a=parseInt(t.level);if(e.value=a,a<config.level)e.setAttribute("placeholder","等级["+a+"]未达到要求"),e.value="";else{var n=React.findDOMNode(this.refs.submit);n.removeAttribute("disabled")}}}.bind(this),complete:function(){this.setState({level_pending:!1})}.bind(this)})}},handleSubmit:function(){if(!this.state.level_pending){var e=React.findDOMNode(this.refs.submit),t=React.findDOMNode(this.refs.id),a=React.findDOMNode(this.refs.tip),n=$("input[name=lng]").val(),l=$("input[name=lat]").val();return e.innerText="请稍后...",e.setAttribute("disabled","disabled"),$.ajax({url:"/",method:"POST",dataType:"json",data:{id:t.value.trim(),lng:n,lat:l},success:function(e){"undefined"!=typeof e&&(0==e.no?location.href=location.href:19==e.msg[1]?a.innerText="已经登记过了":a.innerText=e.msg[2])}.bind(this),complete:function(){e.innerText="填好了",e.removeAttribute("disabled")}.bind(this)}),!1}},render:function(){var e={border:"1px solid #C0C0C0",backgroundColor:"#fff",width:"150px",height:"auto",display:"none"};return React.createElement("section",{className:"am-panel am-panel-default"},React.createElement("header",{className:"am-panel-hd"},React.createElement("h3",{className:"am-panel-title am-text-center"},"位置登记")),React.createElement("div",{className:"am-panel-bd"},React.createElement(Notes,null),React.createElement("label",null,"等级验证"),React.createElement("form",{className:"am-form am-form-inline"},React.createElement("div",{className:"am-form-group am-form-icon"},React.createElement("i",{className:"am-icon-list"}),React.createElement("input",{type:"text",className:"am-form-field",disabled:!0,placeholder:"贴吧",value:config.forum}))," ",React.createElement("div",{className:"am-form-group am-form-icon"},React.createElement("i",{className:"am-icon-user"}),React.createElement("input",{type:"text",className:"am-form-field",placeholder:"ID",maxLength:"20",onBlur:this.handleGetLevel,ref:"id"}))," ",React.createElement("div",{className:"am-form-group am-form-icon"},React.createElement("i",{className:"am-icon-bar-chart"}),React.createElement("input",{type:"text",className:"am-form-field",placeholder:"等级 > "+(config.level-1).toString(),disabled:!0,ref:"level"}))),React.createElement("label",null,"坐标定位"),React.createElement("input",{type:"text",className:"am-form-field",placeholder:"自动定位中...",id:"finder"}),React.createElement("div",{id:"searchResultPanel",style:e}),React.createElement("button",{type:"button",className:"am-btn am-btn-primary",style:{zIndex:"999"},ref:"submit",onClick:this.handleSubmit},"填好了")," ",React.createElement("span",{className:"am-text-warning",ref:"tip"})))}}),Container=React.createClass({displayName:"Container",render:function(){return React.createElement("div",null,React.createElement(Header,null),React.createElement(Map,null),React.createElement("br",null),React.createElement(Register,null),React.createElement(Footer,null))}});React.render(React.createElement(Container,null),document.getElementById("container"));