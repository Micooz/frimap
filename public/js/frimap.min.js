var Map=React.createClass({displayName:"Map",componentDidMount:function(){var e=new BMap.Map("map");e.centerAndZoom(new BMap.Point(104.737059,36.394564),5),e.enableScrollWheelZoom(),e.addControl(new BMap.ScaleControl({anchor:BMAP_ANCHOR_TOP_LEFT})),e.addControl(new BMap.NavigationControl({enableGeolocation:!0})),e.addControl(new BMap.MapTypeControl({mapTypes:[BMAP_NORMAL_MAP,BMAP_HYBRID_MAP]}));var t=new BMap.Geolocation,a=this;t.getCurrentPosition(function(t){if(this.getStatus()==BMAP_STATUS_SUCCESS){var n=t.point,i=new BMap.Marker(n);e.addOverlay(i),e.panTo(n);var l=new BMap.Geocoder;l.getLocation(t.point,function(e){var t=e.addressComponents;document.getElementById("finder").value=t.province+", "+t.city+", "+t.district+", "+t.street+", "+t.streetNumber}),a.props.setPosition(n.lng,n.lat)}else alert("自动定位失败："+this.getStatus())},{enableHighAccuracy:!0});var n=new BMap.Autocomplete({input:"finder",location:e});n.addEventListener("onhighlight",function(e){var t,a=e.fromitem.value,n="";e.fromitem.index>-1&&(n=a.province+a.city+a.district+a.street+a.business),t="FromItem<br />index = "+e.fromitem.index+"<br />value = "+n,n="",e.toitem.index>-1&&(a=e.toitem.value,n=a.province+a.city+a.district+a.street+a.business),t+="<br />ToItem<br />index = "+e.toitem.index+"<br />value = "+n,document.getElementById("searchResultPanel").innerHTML=t}),n.addEventListener("onconfirm",function(t){var n=t.item.value,i=n.province+n.city+n.district+n.street+n.business;document.getElementById("searchResultPanel").innerHTML="onconfirm<br />index = "+t.item.index+"<br />myValue = "+i;var l=new BMap.LocalSearch(e,{onSearchComplete:function(){var t=l.getResults().getPoi(0).point;e.centerAndZoom(t,15),e.addOverlay(new BMap.Marker(t)),a.props.setPosition(t.lng,t.lat)}});l.search(i)});for(var i=new BMap.ContextMenu,l=[{text:"我在这里",callback:function(t){var a=new BMap.Point(t.lng,t.lat),n=new BMap.Geocoder;n.getLocation(a,function(t){var n=t.addressComponents;document.getElementById("finder").value=n.province+", "+n.city+", "+n.district+", "+n.street+", "+n.streetNumber;var i=new BMap.Marker(a);e.addOverlay(i)}),this.props.setPosition(t.lng,t.lat)}.bind(this)}],r=0;r<l.length;r++)i.addItem(new BMap.MenuItem(l[r].text,l[r].callback,100));e.addContextMenu(i),$.ajax({url:"/friends",method:"GET",dataType:"json",success:function(t){"undefined"!=typeof t&&t.map(function(t){var a=new BMap.Point(t.lng,t.lat),n=new BMap.Marker(a);e.addOverlay(n);var i=new BMap.Label(t.username,{position:a,offset:new BMap.Size(10,-30)});i.setStyle({color:"red",fontSize:"12px",height:"20px",lineHeight:"18px",fontFamily:"微软雅黑"}),e.addOverlay(i)})}.bind(this)})},render:function(){var e={width:"100%",height:"700px",border:"1px solid #DCDCDC"};return React.createElement("div",{id:"map",style:e})}}),Notes=React.createClass({displayName:"Notes",render:function(){return React.createElement("ul",{className:"am-list am-list-static am-list-border am-list-striped"},React.createElement("li",null,"1. 请先输入自己的ID"),React.createElement("li",null,"2. 请允许浏览器获取你的位置"),React.createElement("li",null,"3. 如果自动定位有错误，请手动键入自己的位置",React.createElement("label",null,"（需要根据自动提示选取项目）"),"，或者在地图上使用右键标示自己的位置"),React.createElement("li",null,"4. 请勿冒用他人ID"),React.createElement("li",null,"5. 请注意保证自己的隐私"))}}),Register=React.createClass({displayName:"Register",componentDidMount:function(){this.setState({doms:{id:React.findDOMNode(this.refs.id),level:React.findDOMNode(this.refs.level),submit:React.findDOMNode(this.refs.submit),tip:React.findDOMNode(this.refs.tip)}}),React.findDOMNode(this.refs.id).focus(),React.findDOMNode(this.refs.submit).setAttribute("disabled","disabled")},getInitialState:function(){return{level_pending:!1,doms:{id:null,level:null,submit:null,tip:null}}},handleGetLevel:function(){if(!this.state.level_pending){var e=this.state.doms.level,t=this.state.doms.id,a=this.state.doms.submit;if(a.setAttribute("disabled","disabled"),""==t.value.trim())return void t.setAttribute("placeholder","ID不能为空");t.setAttribute("placeholder","ID"),e.setAttribute("disabled","disabled"),e.value="等级获取中...",this.setState({level_pending:!0}),$.ajax({url:"/level?id="+t.value.trim(),method:"GET",dataType:"json",success:function(t){if(-1==parseInt(t.level))e.value="获取失败";else{var n=parseInt(t.level);n<config.level?(e.setAttribute("placeholder","等级["+n+"]未达到要求"),e.value=""):(e.value=n,a.removeAttribute("disabled"))}}.bind(this),complete:function(){this.setState({level_pending:!1})}.bind(this)})}},handleSubmit:function(e){if(e.preventDefault(),!this.state.level_pending){var t=this.state.doms.submit,a=this.state.doms.id,n=this.state.doms.tip,i=this.props.lng,l=this.props.lat;t.innerText="请稍后...",t.setAttribute("disabled","disabled"),$.ajax({url:"/",method:"POST",dataType:"json",data:{id:a.value.trim(),lng:i,lat:l},success:function(e){"undefined"!=typeof e&&(0==e.no?location.href=location.href:19==e.msg[1]?n.innerText="已经登记过了":n.innerText=e.msg[2])}.bind(this),complete:function(){t.innerText="填好了",t.removeAttribute("disabled")}.bind(this)})}},render:function(){var e={border:"1px solid #C0C0C0",backgroundColor:"#fff",width:"150px",height:"auto",display:"none"};return React.createElement("section",{className:"am-panel am-panel-default"},React.createElement("header",{className:"am-panel-hd"},React.createElement("h3",{className:"am-panel-title am-text-center"},"位置登记")),React.createElement("div",{className:"am-panel-bd"},React.createElement(Notes,null),React.createElement("label",null,"等级验证"),React.createElement("form",{className:"am-form am-form-inline"},React.createElement("div",{className:"am-form-group am-form-icon"},React.createElement("i",{className:"am-icon-list"}),React.createElement("input",{type:"text",className:"am-form-field",disabled:!0,placeholder:"贴吧",value:config.forum}))," ",React.createElement("div",{className:"am-form-group am-form-icon"},React.createElement("i",{className:"am-icon-user"}),React.createElement("input",{type:"text",className:"am-form-field",placeholder:"ID",maxLength:"20",onBlur:this.handleGetLevel,ref:"id"}))," ",React.createElement("div",{className:"am-form-group am-form-icon"},React.createElement("i",{className:"am-icon-bar-chart"}),React.createElement("input",{type:"text",className:"am-form-field",placeholder:"等级 >= "+config.level.toString(),disabled:!0,ref:"level"}))),React.createElement("label",null,"坐标定位"),React.createElement("input",{type:"text",className:"am-form-field",placeholder:"自动定位中...",id:"finder"}),React.createElement("div",{id:"searchResultPanel",style:e}),React.createElement("button",{type:"button",className:"am-btn am-btn-primary",style:{zIndex:"999"},ref:"submit",onClick:this.handleSubmit},"填好了")," ",React.createElement("span",{className:"am-text-warning",ref:"tip"})))}}),ContentBox=React.createClass({displayName:"ContentBox",getInitialState:function(){return{lng:0,lat:0}},setPosition:function(e,t){this.setState({lng:e,lat:t})},render:function(){return React.createElement("div",null,React.createElement(Map,{map:this.state.map,setPosition:this.setPosition}),React.createElement("br",null),React.createElement(Register,{lng:this.state.lng,lat:this.state.lat}))}}),Container=React.createClass({displayName:"Container",render:function(){return React.createElement("div",null,React.createElement(Header,null),React.createElement(ContentBox,null),React.createElement(Footer,null))}});React.render(React.createElement(Container,null),document.getElementById("container"));